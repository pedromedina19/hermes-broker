syntax = "proto3";

package broker;

option go_package = "github.com/pedromedina19/hermes-broker/pb";

service BrokerService {
  // Publishing is "Fire and Forget" (Unary)
  rpc Publish (PublishRequest) returns (PublishResponse);

  // Subscribing is a continuous flow of data (Server-Side Streaming).
  rpc Subscribe (stream SubscribeRequest) returns (stream Message);

  //cluster management
  rpc Join (JoinRequest) returns (JoinResponse);
}

message PublishRequest {
  string topic = 1;
  bytes payload = 2; // Raw binary data (serialized JSON or anything else)
}

message PublishResponse {
  bool success = 1;
}

message SubscribeRequest {
  string topic = 1;         // Filled in only on the first package (Handshake)
  string ack_message_id = 2; // Filled in when it is an ACK.
  string action = 3;        // "SUBSCRIBE" or "ACK"
  string group_id = 4; // Consumer Group
}

message Message {
  string id = 1;
  string topic = 2;
  bytes payload = 3;
  int64 timestamp = 4;
}

message JoinRequest {
  string node_id = 1;   // Ex: "node-2"
  string raft_addr = 2; // Ex: "localhost:6001" (raft internal address)
}

message JoinResponse {
  bool success = 1;
  string error = 2;
}